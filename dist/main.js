(()=>{function g(){return h("div",null,h("h1",null,"KINDYEAR Music Info"),h("p",null,"\u672C\u63D2\u4EF6\u53EF\u4EE5\u8F93\u51FA\u6B4C\u66F2\u7684\u540D\u79F0\u3001\u6B4C\u624B\u540D\u79F0\u81F3\u672C\u5730txt\u6587\u4EF6\uFF0C\u5C01\u9762\u4FDD\u5B58\u4E3A\u672C\u5730\u56FE\u7247"),h("p",null,"\u53EF\u5728OBS\u7B49\u76F4\u64AD\u8F6F\u4EF6\u4E2D\u8BFB\u53D6\u672C\u5730\u6587\u672C\u6216\u56FE\u7247\u5B9E\u73B0\u663E\u793A"),h("p",null,"\u8F93\u51FA\u7684\u4FE1\u606F\u76EE\u5F55\u4E3A\u63D2\u4EF6\u76EE\u5F55\u7684plugins_runtime/KINDYEAR-MusicInfo/output"))}plugin.onConfig(()=>{let e=document.createElement("div");return ReactDOM.render(g(),e),e});var d=null,p=null,v=null,m=null,I=null,$=null,u=betterncm_native.fs.exists("plugins_dev/KINDYEAR-MusicInfo/");plugin.onLoad(async()=>{console.log("[KMI] KMI Loaded,Dev mode:",u),u===!1&&(console.log=()=>{}),legacyNativeCmder.appendRegisterCall("Load","audioplayer",()=>{new MutationObserver(async()=>{let t=document.querySelector("a.title"),o=document.querySelector("a.artist"),l=document.querySelector("img.front.normal.j-cover");t&&(d=t.getAttribute("title")),o&&(p=o.textContent),l&&(v=l.getAttribute("src")),await R(d,p,v)}).observe(document.body,{childList:!0,subtree:!0})})});async function R(e,t,o){let l=await betterncm.app.getDataPath(),i,n;if(u===!0?(n="DEV",i=`${l}\\plugins_dev\\KINDYEAR-MusicInfo\\output`):(n="RUNTIME",i=`${l}\\plugins_runtime\\KINDYEAR-MusicInfo\\output`),e===null||t===null||o===null||e===void 0||t===void 0||o===void 0)return;let r=o?.match(/https:\/\/[^/]+\/[^?]+/)?.[0];if(e!==m||t!==I||r!==$){console.log(`[KMI][${n}] Info is different, start to save.`),m=e,I=t,$=r;let c=betterncm_native.fs.writeFileText(`${i}\\Title.txt`,`${e}`),a=betterncm_native.fs.writeFileText(`${i}\\Artist.txt`,`${t}`),f=`${i}\\Cover.png`,M=await betterncm.app.exec(`powershell.exe rm "${f}\\Cover.png"`);console.log(`[KMI][${n}] Old Cover Delete Result: ${M}`);let s=await betterncm.app.exec(`powershell.exe Invoke-WebRequest -Uri "${r}" -OutFile "${f}"`);console.log(`[KMI][${n}] Music Info: ${e} - ${t} - ${r} .`),s===!0?console.log(`[KMI][${n}] Save Result: Title:${c} - Artist:${a} - Cover:${s}`):console.error(`[KMI][${n}] Save Result: Title:${c} - Artist:${a} - Cover:${s}`);return}else{console.log(`[KMI][${n}] Info is same, no need to save.`);return}}plugin.onAllPluginsLoaded(()=>{});})();
