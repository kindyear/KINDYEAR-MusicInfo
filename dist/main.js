(()=>{function c(){return h("div",null,h("h1",null,"KINDYEAR Music Info"),h("p",null,"\u672C\u63D2\u4EF6\u53EF\u4EE5\u8F93\u51FA\u6B4C\u66F2\u7684\u540D\u79F0\u3001\u6B4C\u624B\u540D\u79F0\u81F3\u672C\u5730txt\u6587\u4EF6\uFF0C\u5C01\u9762\u4FDD\u5B58\u4E3A\u672C\u5730\u56FE\u7247"),h("p",null,"\u53EF\u5728OBS\u7B49\u76F4\u64AD\u8F6F\u4EF6\u4E2D\u8BFB\u53D6\u672C\u5730\u6587\u672C\u6216\u56FE\u7247\u5B9E\u73B0\u663E\u793A"),h("p",null,"\u8F93\u51FA\u7684\u4FE1\u606F\u76EE\u5F55\u4E3A\u63D2\u4EF6\u76EE\u5F55\u7684plugins_runtime/KINDYEAR-MusicInfo/output"))}plugin.onConfig(()=>{let e=document.createElement("div");return ReactDOM.render(c(),e),e});var a=null,v=null,f=null,p=null,g=null,d=null,m=betterncm_native.fs.exists("plugins_dev/KINDYEAR-MusicInfo/");plugin.onLoad(async()=>{console.log("[KMI] KMI Loaded,Dev mode:",m),legacyNativeCmder.appendRegisterCall("Load","audioplayer",()=>{let e=new MutationObserver(async()=>{let l=document.querySelector("a.title"),o=document.querySelector("a.artist"),t=document.querySelector("img.front.normal.j-cover");l&&(a=l.getAttribute("title")),o&&(v=o.textContent),t&&(f=t.getAttribute("src")),await $(a,v,f)});document.querySelector("a.title.f-oh.j-title")?e.observe(document.body,{childList:!0,subtree:!0}):console.error("Title element not found!")}),window.addEventListener("DOMContentLoaded",()=>{})});function I(e,n,l){return e!==p||n!==g||l!==d}async function $(e,n,l){let o=l?.match(/https:\/\/[^/]+\/[^?]+/)?.[0];if(I(e,n,o)){let t=await betterncm.app.getDataPath();if(m===!0){let s=betterncm_native.fs.writeFileText(`${t}\\plugins_dev\\KINDYEAR-MusicInfo\\output\\Title.txt`,`${e}`),r=betterncm_native.fs.writeFileText(`${t}\\plugins_dev\\KINDYEAR-MusicInfo\\output\\Artist.txt`,`${n}`),u=`${t}\\plugins_dev\\KINDYEAR-MusicInfo\\output\\Cover.png`,i=await betterncm.app.exec(`powershell.exe Invoke-WebRequest -Uri "${o}" -OutFile "${u}"`);i===!0?console.log(`[KMI] Save Result: Title:${s} - Artist:${r} - Cover:${i}`):console.error(`[KMI] Save Result: Title:${s} - Artist:${r} - Cover:${i}`)}else{let s=betterncm_native.fs.writeFileText(`${t}\\plugins_runtime\\KINDYEAR-MusicInfo\\output\\Title.txt`,`${e}`),r=betterncm_native.fs.writeFileText(`${t}\\plugins_runtime\\KINDYEAR-MusicInfo\\output\\Artist.txt`,`${n}`),u=`${t}\\plugins_runtime\\KINDYEAR-MusicInfo\\output\\Cover.png`,i=await betterncm.app.exec(`powershell.exe Invoke-WebRequest -Uri "${o}" -OutFile "${u}"`);console.log(`[KMI] Music Info: ${e} - ${n} - ${o},info is different, save.`),i===!0?console.log(`[KMI] Save Result: Title:${s} - Artist:${r} - Cover:${i}`):console.error(`[KMI] Save Result: Title:${s} - Artist:${r} - Cover:${i}`)}p=e,g=n,d=o}}plugin.onAllPluginsLoaded(()=>{});})();
